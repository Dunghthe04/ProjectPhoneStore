extends ../../layouts/default.pug
include ../../mixins/filterButton.pug
include ../../mixins/searchByKeyword.pug
include ../../mixins/pagination.pug
include ../../mixins/formChangeMulti.pug
include ../../mixins/alert.pug
include ../../mixins/moment.pug
block main 
 if(roleAccount.permissions.includes("product-view"))
  h1 Danh sach san pham
    +alert-success(3000)
    +alert-error(3000)
    .card.mb-3 
    .card-header Bộ lọc và tìm kiếm 
    .card-body 
      .row 
        .col-7 
          //-Tối ưu filter button
          +filterButton(filterButtons)
        .col-5 
          //-Tối ưu searchByKeyword
          +searchByKeyword(keywordSearch)

    .card.mb-3 
    .card-header Sắp xếp 
    .card-body 
      .row 
        .col-4 
          div(sort)
            select(
              class="form-control"
              name="sort"
              sort-select
            )
              option(value="position-desc") Vị trí giảm dần 
              option(value="position-asc") Vị trí tăng dần 
              option(value="price-desc") Giá giảm dần 
              option(value="price-asc") Giá tăng dần 
              option(value="title-desc") Tiêu đề A - Z 
              option(value="title-asc") Tiêu đề Z - A 
            button(
              class="btn btn-danger mt-2"
              sort-clear
            ) Clear  
    .card.mb-3 
    .card-header Danh sách sản phẩm
      .card-body 
      .row 
          .col-9
              if(roleAccount.permissions.includes("product-edit"))
                +formChangeMulti(`${prefixAdmin}/products/change-multi?_method=PATCH`)
                
          .col-3
              .row 
                .col-5
                  if(roleAccount.permissions.includes("product-add"))
                    a(
                      href=`${prefixAdmin}/products/create`
                      class="btn btn-outline-success"
                    ) + Thêm mới 
                .col-4
                  if(roleAccount.permissions.includes("product-delete"))
                    a(
                      href=`${prefixAdmin}/products/recover`
                      class="d-flex justify-content-end"
                    )
                     button(class="btn btn-dark btn-sm") Xóa gần đây

                
      table(
        class="table table-hover table-sm"
        check-box-multi
      )
        thead 
              tr 
                th 
                  input(type="checkbox" name="checkall")
                th STT 
                th Hình ảnh 
                th Tiêu đề
                th Giá
                th Vị trí
                th Trạng thái 
                th Người tạo
                th Người chỉnh sửa gần nhất
                th Hành động
        tbody 
            each item, index in products
              tr 
                td 
                  input(type="checkbox" name="id" value=item.id)
                td #{(objectPagination.currentPage-1)*objectPagination.limit+1+index}
                td 
                    img(src=item.thumbnail
                        alt=item.title
                        width="100px"
                        height="auto"
                        )
                td #{item.title}
                td #{item.price} $
                td 
                  input(
                    type="text"
                    value=item.position 
                    style="width: 60px"
                    min="1"
                    name="position"
                  )
                
                td 
                  if(roleAccount.permissions.includes("product-edit"))
                    if(item.status=="active")
                        a(href="javascript:;"
                          data-status=item.status
                          data-id=item.id
                          button-change-status
                          class="badge badge-success") Hoạt động
                    else 
                        a(href="javascript:;"
                        data-status=item.status
                        data-id=item.id
                        button-change-status
                        class="badge badge-danger") Dừng hoạt động   
                td 
                  p #{item.creater} 
                  +formatDateTime(item.createBy.createAt) 
                td 
                  - const updateByCurrently=item.updateBy.slice(-1)[0]
                  if(updateByCurrently)
                    p #{updateByCurrently.fullnameEditer} 
                    +formatDateTime(item.updateBy.updateDate) 
                td 
                    if(roleAccount.permissions.includes("product-edit"))
                      a(
                        href=`${prefixAdmin}/products/edit/${item.id}`
                        class="btn btn-warning btn-sm") Sửa
                    if(roleAccount.permissions.includes("product-delete"))
                      button(
                        class="btn btn-danger btn-sm ml-1 "
                        data-id=item.id
                        button-delete
                        ) Xóa
                    a(
                      href=`${prefixAdmin}/products/detail/${item.id}`
                      class="btn btn-secondary btn-sm ml-1") Chi tiết      
    //-Tối ưu pagination
    +pagination(objectPagination)    

    form(
      action=""
      method="Post"
      id="formChangeStatus"
      path=`${prefixAdmin}/products/change-product-status`
    )

    form(
      action=""
      method="POST"
      id="formDelete"
      path=`${prefixAdmin}/products/delete`
    )
    script(src="/admin/js/products.js")                    